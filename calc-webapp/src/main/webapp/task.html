
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Open Foris &middot; Calc</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<!--     <meta name="description" content=""> -->
<!--     <meta name="author" content=""> -->

    <!-- Le styles -->
    <link href="css/bootstrap.css" rel="stylesheet">
    <link href="css/bootstrap-responsive.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">    
    

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
<!--     <link rel="apple-touch-icon-precomposed" sizes="144x144" href="ico/apple-touch-icon-144-precomposed.png"> -->
<!--     <link rel="apple-touch-icon-precomposed" sizes="114x114" href="ico/apple-touch-icon-114-precomposed.png"> -->
<!--     <link rel="apple-touch-icon-precomposed" sizes="72x72" href="ico/apple-touch-icon-72-precomposed.png"> -->
<!--     <link rel="apple-touch-icon-precomposed" href="ico/apple-touch-icon-57-precomposed.png"> -->
<!-- 	<link rel="shortcut icon" href="ico/favicon.png"> -->
	
  </head>

  <body>

    <div class="container">

      <div class="masthead">
        <h3 class="muted">Open Foris Calc</h3>
        <div class="navbar">
          <div class="navbar-inner">
            <div class="container">
              <ul class="nav">
                <li class="active"><a href="#">Home</a></li>
                <li><a href="#">Workspaces</a></li>
<!--                 <li><a href="#">Services</a></li> -->
<!--                 <li><a href="#">Downloads</a></li> -->
<!--                 <li><a href="#">About</a></li> -->
<!--                 <li><a href="#">Contact</a></li> -->
              </ul>
            </div>
          </div>
        </div><!-- /.navbar -->
      </div>
	
		<div class="container">
			<div class="row-fluid">
				<div class="workspace-selector span4">
					<div>
						Workspace: 
					</div>
					<div class="btn-group">
						<button class="btn btn-primary selector-button"> -- Select workspace --</button>
						<button class="btn btn-primary dropdown-toggle"
							data-toggle="dropdown">
							<span class="caret"></span>
						</button>
						<ul class="dropdown-menu">
							<li><a href="#">Action</a></li>
		<!-- 					<li><a href="#">Another action</a></li> -->
		<!-- 					<li><a href="#">Something else here</a></li> -->
		<!-- 					<li class="divider"></li> -->
		<!-- 					<li><a href="#">Separated link</a></li> -->
						</ul>
					</div>
				</div>			
				<div class="processing-chain-selector span4">
					<div>
						Chain: 
					</div>
					<div class="btn-group">
						<button class="btn btn-info selector-button"> -- Select processing chain --</button>
						<button class="btn btn-info dropdown-toggle" data-toggle="dropdown">
							<span class="caret"></span>
						</button>
						<ul class="dropdown-menu">
	<!-- 						<li><a href="#">Action</a></li> -->
		<!-- 					<li><a href="#">Another action</a></li> -->
		<!-- 					<li><a href="#">Something else here</a></li> -->
		<!-- 					<li class="divider"></li> -->
		<!-- 					<li><a href="#">Separated link</a></li> -->
						</ul>
					</div>
				</div>
			</div>
		</div>
	
      <!-- Jumbotron -->
      <div class="jumbotron">
			
			<!--         <h1>Marketing stuff!</h1> -->
<!--         <p class="lead"> -->
<!--         Cras justo odio, dapibus ac facilisis in, egestas eget quam. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus.</p> -->
		<form 
			name="exec-tasks-form" 
			class="form-exec-tasks"
			action="rest/execTasks.json"
			method="get">
			<table class="table table-striped table-hover">
	  			<thead>
	  				<tr>
	  					<th width="50px">#</th>
		  				<th>Step Name</th>
	  				</tr>  				
	  			</thead>
	  			<tbody>
<!-- 	  				<tr> -->
<!-- 	  					<td>1</td> -->
<!-- 	  					<td style="vertical-align: middle;"> -->
<!-- 	  						<input type="checkbox" value="yes" name="step1" checked="checked"> -->
<!-- 	  						Step 1 -->
<!-- 	  					</td> -->
<!-- 	  				</tr> -->
<!-- 	  				<tr> -->
<!-- 	  					<td>2</td> -->
<!-- 	  					<td>Step 2</td> -->
<!-- 	  				</tr> -->
	  			</tbody>
			</table>
			<button type="submit" value="Execute" class="btn-inverse btn-small">Execute</button>
		</form>
<!--         <a class="btn" href="#">Execute</a> -->
      </div>

<!--       <hr> -->

      <!-- Example row of columns -->
<!--       <div class="row-fluid"> -->
<!--         <div class="span4"> -->
<!--           <h2>Heading</h2> -->
<!--           <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p> -->
<!--           <p><a class="btn" href="#">View details &raquo;</a></p> -->
<!--         </div> -->
<!--         <div class="span4"> -->
<!--           <h2>Heading</h2> -->
<!--           <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p> -->
<!--           <p><a class="btn" href="#">View details &raquo;</a></p> -->
<!--        </div> -->
<!--         <div class="span4"> -->
<!--           <h2>Heading</h2> -->
<!--           <p>Donec sed odio dui. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Vestibulum id ligula porta felis euismod semper. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa.</p> -->
<!--           <p><a class="btn" href="#">View details &raquo;</a></p> -->
<!--         </div> -->
<!--       </div> -->

      <hr>

      <div class="footer">
        <p>&copy; Open Foris 2013</p>
      </div>

    </div> <!-- /container -->

    <!-- Le javascript
    ================================================== -->
    <!-- Jquery -->
    <script src="js/jquery.js"></script>
    
    <!-- Bootstrap -->
    <script src="js/bootstrap-transition.js"></script>
    <script src="js/bootstrap-alert.js"></script>
    <script src="js/bootstrap-modal.js"></script>
    <script src="js/bootstrap-dropdown.js"></script>
    <script src="js/bootstrap-scrollspy.js"></script>
    <script src="js/bootstrap-tab.js"></script>
    <script src="js/bootstrap-tooltip.js"></script>
    <script src="js/bootstrap-popover.js"></script>
    <script src="js/bootstrap-button.js"></script>
    <script src="js/bootstrap-collapse.js"></script>
    <script src="js/bootstrap-carousel.js"></script>
    <script src="js/bootstrap-typeahead.js"></script>

	<!-- JSONpath -->
	<script src="js/jsonpath-0.8.0.js"></script>
	
	<script>
	
	$(document).ready(function(event){
		/**
			The workspaces currently active in the drop down
		*/
		$workspaces = null;
		/**
			The chains currently active in the drop down selector
		*/
		$chains = null;
		/**
		* The processing chain job currently selected
		*/
		$job = null;
		
		loadWorkspaces = function(){
			//hide processing chain selection
			$(".processing-chain-selector").hide();
			$(".form-exec-tasks").hide();
			
			$.getJSON(
				"rest/workspaces.json"
			).done(
					function(ws) {
						$workspaces = ws;
						$ul = $(".workspace-selector ul");
						$.each(
								$workspaces,
								function(i, w) {

									$li = $( '<li><a href="'+w.id+'">'+w.name+'</a></li>' );
									$li.on( "click", changeWorkspaceHandler );
									$ul.append($li);	
								}
						);
					}			
			);
		};
		
		changeWorkspaceHandler = function(e) {
			e.preventDefault();
			
			$a = $(this).find("a");
			$wsId = $a.attr("href");
			$wsName = $a.html();
			
			$ws = $(".workspace-selector");
			$btn = $($ws).find(".selector-button").html($wsName);
			
			loadProcessingChains($wsId);
			//console.log('click of ' +$(this).html()+" id: " + $wsId + "name"+ $wsName);
		};
		
		loadProcessingChains = function($wsId) {
// 			console.log($workspaces);
			$workspace = null;
			$.each(
					$workspaces,
					function(i, w) {
						if(w.id == $wsId) {
							$workspace = w;
							return( false );
						}
					}
			);
			$chains = $workspace.processingChains;
			
			$ul = $(".processing-chain-selector ul");
			$.each(
					$chains,
					function(i, c) {
						$li = $( '<li><a href="'+c.id+'">'+c.name+'</a></li>' );
						$li.on( "click", changeProcessingChainHandler );
						$ul.append($li);	
					}
			);
			
			$( ".processing-chain-selector" ).fadeIn();
		};
		
// 		$('.workspace-selector li').on(
// 			"click",
// 			changeWorkspaceHandler
// 		);
		
		
		changeProcessingChainHandler = function(e) {
			e.preventDefault();
			
			$a = $(this).find("a");
			$name = $a.html();
			$id = $a.attr("href");
			
			$url = "rest/workspaces/chains/"+$id+"/jobs.json";
			$.getJSON(
				$url		
			).done(
				function(response) {
					//set button text with selected chain
					$obj = $(".processing-chain-selector");
					$btn = $($obj).find(".selector-button").html($name);
					
					// set the active processing chain job
					$job = response;
					
					showProcessingChainJob();
				}
			); 
			
		};
		
		showProcessingChainJob = function( ) {
// 			console.log($job);			
			
			$tasks = $job.tasks;
			$.each(
				$chain.calculationSteps,
				function(i, s){
					$tr = $("<tr></tr>");
					//$tdId = $("<td>#"+i +"(id:"+s.id+")</td>");					
					//$tr.append($tdId);
					
					$tdStep = $('<td><label class="checkbox"><input type="checkbox" value="yes" name="'+s.id+'" checked="checked">'+s.name+'</label></td>');
					$tr.append($tdStep);
					
					$form.find('tbody').append($tr);
				}
			);
			
			
			// show the table with tasks
			$form = $(".form-exec-tasks");
			$form.fadeIn();
		}
		
		loadSteps = function(id) {
			$form = $(".form-exec-tasks");
			$form.fadeIn();
			
			$chain = null;
			$.each(
					$chains,
					function(i, c) {
						if(c.id == id) {
							$chain = c;
							return( false );
						}
					}
			);
			
			console.log($chain);
			$.each(
				$chain.calculationSteps,
				function(i, s){
					$tr = $("<tr></tr>");
					$tdId = $("<td>#"+i +"(id:"+s.id+")</td>");					
					
					$tr.append($tdId);
					
					$tdStep = $('<td><label class="checkbox"><input type="checkbox" value="yes" name="'+s.id+'" checked="checked">'+s.name+'</label></td>');
					$tr.append($tdStep);
					
					$form.find('tbody').append($tr);
				}
			);
// 			<tr>
// 				<td>1</td>
// 				<td style="vertical-align: middle;">
// 					<input type="checkbox" value="yes" name="step1" checked="checked">
// 					Step 1
// 				</td>
// 			</tr>
		};
		
		loadWorkspaces();
		
	});
	</script>

  </body>
</html>
