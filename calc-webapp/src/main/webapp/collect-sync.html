<!-- ==== Html here === -->

<div class="row">
	<div class="col-md-12">
		<form id="collectSyncForm" method="post" enctype="multipart/form-data" action="rest/collect/data.json">
			<button id="collectSyncUploadButton" type="button" class="btn btn-info btn-lg">Upload Collect Backup File</button>
		    <input id="collectSyncFile" type="file" name="file" style="display:none" />		    		    
		</form>	
	</div>
</div>
<div class="row">
	<div class="col-md-12">
		<div id="collectSyncProgressOverlay" style="display:none">
			<div class="progress progress-striped active">
	        	<div id="collectSyncProgressBar" class="progress-bar progress-bar-info"></div>
	        </div>
	        <div id="collectSyncProgressPercent" class="percent">0%</div>
	    </div>
    </div>
</div>

<script>
$(function(){
	
	$('#collectSyncForm').ajaxForm( {
	    dataType : 'json',
	    beforeSubmit: function() {
	    	console.log('before submit');
	        $(this).addClass('loading');
	        $('#collectSyncUploadButton').hide();
			$("#collectSyncProgressOverlay").show();
	    },
	    uploadProgress: function ( event, position, total, percentComplete ) {
	    	console.log('upload progress');
	    	console.log(event);
	    	console.log(percentComplete);
	    	var percentVal = percentComplete+'%';
            $('#collectSyncProgressBar').width(percentVal);
            $('#collectSyncProgressPercent').html(percentVal);
	    },
	    success: function ( json ) {
	    	console.log('success');
	    	checkJobStatus();
	    },
	    error: function (e) {
	    	console.log('error: ' + e);
	    	alert('Error uploading file');
	        $('#collectSyncUploadButton').show();
			$("#collectSyncProgressOverlay").hide();
	    }
	});	
	
	$("#collectSyncUploadButton").click(function(event) {
		$('#collectSyncFile').click();
	});
	
	$("#collectSyncFile").change(function(event) {
		console.log('submit');
		$('#collectSyncForm').submit();
	});
	
});
</script>