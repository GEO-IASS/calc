<!-- ==== Html here === -->
<div class="page-section">
	<div class="row">
		<div class="col-md-3">
		</div>
		<div class="col-md-6">
		
<!-- 		<div class="well"> -->
			<form id="step-form" class="form-horizontal">
				<fieldset>
					Calculation Step Editor
					<div class="form-group">
						<label for="name" class="col-lg-2 control-label">Name</label>
						<div class="col-lg-10">
							<input type="text" class="form-control" name="name">
						</div>
					</div>
					<div class="form-group">
						<label class="col-lg-2 control-label">Select Entity</label>
						<div class="col-lg-10">
							<select class="form-control" name="entity"></select>
						</div>
					</div>
					<div class="form-group">
						<label for="select-variable" class="col-lg-2 control-label">Output Variable</label>
						<div class="col-lg-9">
							<select class="form-control" name="variable" disabled="disabled"></select>
						</div>
						<div class="col-lg-1">
							<button name="add-variable" class="calculation btn btn-info" >
								<i class="icon-plus-sign-alt" style="font-size: 22px;"></i>
							</button>
						</div>
					</div>
					<div class="form-group">
						<label class="col-lg-2 control-label">Type</label>
						
						<div class="col-lg-2">
							<div class="radio">
								<label><input type="radio" name="type" value="formula" /> Formula</label>
							</div>
						</div>
						<div class="col-lg-2">
							<div class="radio">								
								<label><input type="radio" name="type" value="r" /> R</label>
							</div>	
						</div>
						<div class="col-lg-2">
							<div class="radio">								
								<label><input type="radio" name="type" value="sql" /> SQL</label>
							</div>
						</div>
						<div class="col-lg-4"></div>
						
					</div>
					<div class="form-group buttons">
						<div class="col-lg-1 col-lg-offset-2">
							<button type="submit" class="btn btn-default btn-lg">Save</button>
							
						</div>
						<div class="col-lg-2">
							<button class="btn btn-default cancel btn-lg">Cancel</button>
						</div>
					</div>
				</fieldset>
			</form>
		</div>
		<div class="col-md-3">
		</div>
<!-- 		</div> -->
	</div>
	
<script>
$(function(){
	$stepForm = $('#step-form');
	$entitySelect = $stepForm.find("[name='entity']");
	$variableSelect = $stepForm.find("[name='variable']");
	
	updateEntities = function() {
		$entitySelect.empty();
		$variableSelect.attr("disabled", "disabled");
		$variableSelect.empty();
		
		$.ajax({
			url: "rest/workspace/entities.json",
			dataType: "json"
		})
		.done(function(response) {
			var entities = response;
			$.each(entities, function(i, entity) {
				 $entitySelect.append($("<option />").val(entity.id).text(entity.name));
			});
			//updateVariables();
			$entitySelect.val([]);
		}); 
	};
	
	updateVariables = function() {
		$variableSelect.attr("disabled", "disabled");
		$variableSelect.empty();
	
		$selectedEntityOption = $entitySelect.find(":selected");
		if ( $selectedEntityOption != null ) {
			$.ajax({
				url: "rest/workspace/entities/" + $selectedEntityOption.val() + "/variables.json",
				dataType: "json"
			})
			.done(function(response) {
				var variables = response;
				$.each(variables, function(i, variable) {
					 $variableSelect.append($("<option />").val(variable.id).text(variable.name));
				});
				$variableSelect.removeAttr("disabled");
			}); 
		}
	};
	
	$entitySelect.change(function(event) {
		updateVariables();
	});
	
	updateEntities();
	
});
</script>
</div>