Compile with:

	mvn compile
   
Run unit tests with:

	mvn package

Run integration tests with:

	mvn verify
    

In order to create the database (using PostgreSQL 9.2 or greater) run from command line:

	psql -U postgres -f calc-core/src/main/resources/org/openforis/calc/db/init.sql


Add dev database settings to calc-core/src/main/resources/dev.properties.

Regenerate jOOQ stub classes*: 

	cd calc-core
	mvn properties:read-project-properties jooq-codegen:generate

* Requires dev database settings in dev.properties.


IMPORTANT: When making updates to the database schema, ALWAYS ADD A Liquibase 
           MIGRATION TO calc-core/design/db/changelog.  These will be automatically run
           when building during Maven's "process-resources" phase.           
           See http://www.liquibase.org/quickstart.html for more details.   
  
 
============================================================================
 				R Installation guide
============================================================================
Mac Os X
========
	- Download (http://cran.r-project.org/bin/macosx/) and install r
		( If using OS X Mountain Lion install X11  (http://support.apple.com/kb/HT5293?viewlocale=en_US&locale=en_US) )

	- Install R required packages
		sudo R
		install.packages("RPostgreSQL")
	 	install.packages("rJava")
	
	- set R_HOME environment variable
		1. add to the file /etc/launchd.con (sudo vi /etc/launchd.conf) the following line:
			setenv R_HOME /Library/Frameworks/R.framework/Resources
		2. reboot computer
		
=======  
UBUNTU
======= 
	Follow the istructions on http://cran.rstudio.com/
	
	add repository to sources list: 
		sudo gedit /etc/apt/sources.list
			add a new entry:
			deb http://cran.rstudio.com/bin/linux/ubuntu precise/
	
	
	gpg --keyserver pgp.mit.edu --recv-key 51716619E084DAB9
	gpg -a --export E084DAB9 | apt-key add -
	
	sudo apt-get update
	sudo apt-get install r-base
	

	Set enviroment variable  (e.g. sudo gedit /etc/environment)
		R_HOME=/usr/lib/R
		(if using x64 os: R_HOME=/usr/lib64/R)
	
	
- Install R required packages:
		
		sudo apt-get install libpq-dev

		tar -xvf calc/lib/lmfor_1.1_R_i686-pc-linux-gnu.tar.gz 
		sudo R CMD INSTALL --build lmfor
		rm -r lmfor
		
		sudo R
			install.packages("RPostgreSQL")
	
	
- Install rJava
	 	install.packages("rJava")

		If having problem (like : libjvm.so: cannot open shared object file: No such file or directory):
			- check with ll command the permission of libjvm file
			
			- modify /etc/environment file and add:
				LD_LIBRARY_PATH=$JAVA_HOME/jre/lib/i386:$JAVA_HOME/jre/lib/i386/client
			(log out and login again)
			
			- run javareconf:
				sudo R CMD javareconf

==============
Linux RedHat 6
==============
	(64bit)
	sudo rpm -Uvh http://download.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
	(32 bit)
	sudo rpm -Uvh http://download.fedoraproject.org/pub/epel/6/i386/epel-release-6-8.noarch.rpm
	
	sudo yum update
	sudo yum install R
	
	- in case of missing required packages error (texinfo, texinfo-tex):
	
		sudo yum install texinfo
	
		sudo rpm -Uvh http://mirror.centos.org/centos/6/os/x86_64/Packages/texinfo-tex-4.13a-8.el6.x86_64.rpm
		
		sudo yum install R
	
	- continue installing required R libraries (see Ubuntu instructions but skip installing libpq-dev)
	
	Set environment variable (see above)

=======
Windows
=======

	- Download R for Windows (http://cran.r-project.org/bin/windows/base/)
	
	- Run the downloaded installer and accept the default settings or specify the preferred ones.
	
	(If you install R under Windows Vista/7, please install it outside of c:\program files, e.g. c:\opt\r)
	
	In case of troubles installing R under Windows Vista/7, please see the R FAQ (http://cran.r-project.org/bin/windows/base/rw-FAQ.html).
	
	- Configure environment variables:
		- Define R_HOME environment variable ( e.g. R_HOME=c:\opt\R )
		- Add %R_HOME%\bin and %R_HOME%\bin\i386 (or other folder containing R.dll) to the PATH environment variable (e.g. PATH=%PATH%;%R_HOME%\bin )
	
	- Install R required packages:
		From command line type:
			R CMD INSTALL calc\lib\lmfor_1.1_20130520.zip
	
		From command line type:
			R
			
			Then inside R terminal type:
				
				install.packages("RPostgreSQL")
				install.packages("rJava")
		
	- Check that rJava is properly installed.
		Inside R terminal type:
			
			library(rJava)
			
			(if getting an error, check that JAVA_HOME is properly defined)
	
	- Add %R_HOME%\library\rJava\jri to the PATH environment variable


============================================================================
 				JNDI database resource configuration
============================================================================

==============
Tomcat 7
==============
	
	- If using a standalone Tomcat installation, define the same resource in a file calc.xml inside tomcat/conf/Catalina/localhost:
		
		<!-- calc.xml file -->
		
		<?xml version="1.0" encoding="UTF-8"?>
		
		<Context path="/calc" reloadable="false">
			
			<Resource 
			   name="jdbc/calcDs" 
			   auth="Container"
			   type="javax.sql.DataSource"
			   factory="org.apache.commons.dbcp.BasicDataSourceFactory"
			   driverClassName="org.postgresql.Driver"
			   url="jdbc:postgresql://localhost:5432/calc"
			   username="calc"
			   password="calc"
			   initialSize="5"
			   maxActive="20"
			   maxIdle="5" />
			   
		</Context>
		
		<!-- end of calc.xml file -->
	
	- If Tomcat server uses Eclipse metadata, define the JNDI resource in the context.xml file of the relative server.
	