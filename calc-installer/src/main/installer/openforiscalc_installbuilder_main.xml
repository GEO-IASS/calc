<component>
    <name>default</name>
    <description>Default Component</description>
    <canBeEdited>1</canBeEdited>
    <selected>1</selected>
    <show>1</show>
    <desktopShortcutList>
        <shortcut>
            <comment></comment>
            <exec>${installdir}/${java_launcher_binary_name}</exec>
            <icon>${installdir}/calc-server/tomcat/webapps/calc/img/of-logo-small.png</icon>
            <name>Open Foris Calc Control Panel</name>
            <path></path>
            <platforms>all</platforms>
            <runAsAdmin>0</runAsAdmin>
            <runInTerminal>0</runInTerminal>
            <windowsExec>${installdir}/${java_launcher_binary_name}</windowsExec>
            <windowsExecArgs></windowsExecArgs>
            <windowsIcon>${installdir}/calc-server/tomcat/webapps/calc/img/of-logo-small-ico.ico</windowsIcon>
            <windowsPath></windowsPath>
        </shortcut>
    </desktopShortcutList>
    <folderList>
        <folder>
            <description>Program Files</description>
            <destination>${installdir}</destination>
            <name>programfiles</name>
            <platforms>all</platforms>
            <distributionFileList>
                <distributionFile>
                    <origin>../../../../calc-control-panel/target/OpenForisCalc.jar</origin>
                </distributionFile>
                <distributionFile>
                    <origin>../../../../calc-assembly/target/calc-server.zip</origin>
                </distributionFile>
            </distributionFileList>
            <shortcutList>
                <shortcut>
                    <comment>Uninstall</comment>
                    <exec>${installdir}/${uninstallerName}</exec>
                    <icon></icon>
                    <name>Uninstall ${product_fullname}</name>
                    <path>${installdir}</path>
                    <platforms>all</platforms>
                    <runAsAdmin>0</runAsAdmin>
                    <runInTerminal>0</runInTerminal>
                    <windowsExec>${installdir}/${uninstallerName}.exe</windowsExec>
                    <windowsExecArgs></windowsExecArgs>
                    <windowsIcon></windowsIcon>
                    <windowsPath>${installdir}</windowsPath>
                </shortcut>
            </shortcutList>
        </folder>
        <folder>
            <description>Program Files</description>
            <destination>${installdir}</destination>
            <name>programfileslinux</name>
            <platforms>linux</platforms>
            <distributionFileList>
                <distributionDirectory>
                    <origin>R/R-linux</origin>
                </distributionDirectory>
            </distributionFileList>
        </folder>
        <folder>
            <description>Program Files</description>
            <destination>${installdir}</destination>
            <name>programfileswindows</name>
            <platforms>windows</platforms>
            <distributionFileList>
                <distributionDirectory>
                    <origin>R/R-windows</origin>
                </distributionDirectory>
            </distributionFileList>
        </folder>
        <folder>
            <description>Program Files</description>
            <destination>${installdir}</destination>
            <name>programfilesosx</name>
            <platforms>osx</platforms>
            <distributionFileList>
                <distributionDirectory>
                    <origin>R/R-mac</origin>
                </distributionDirectory>
            </distributionFileList>
        </folder>
    </folderList>
    <parameterList>
        <directoryParameter>
            <name>installdir</name>
            <description>Installer.Parameter.installdir.description</description>
            <explanation>Installer.Parameter.installdir.explanation</explanation>
            <value></value>
            <default>${platform_install_prefix}/${product_shortname}</default>
            <allowEmptyValue>0</allowEmptyValue>
            <cliOptionName>prefix</cliOptionName>
            <mustBeWritable>1</mustBeWritable>
            <mustExist>0</mustExist>
            <width>30</width>
        </directoryParameter>
        <directoryParameter>
            <name>r_install_dir</name>
            <title>Please select your R installation directory</title>
            <description></description>
            <explanation></explanation>
            <value></value>
            <default>${env(R_HOME)}</default>
            <allowEmptyValue>0</allowEmptyValue>
            <mustBeWritable>0</mustBeWritable>
            <mustExist>1</mustExist>
            <width>30</width>
        </directoryParameter>
        <!-- parameters for creating Java launchers -->
        <stringParameter name="java_launcher_destination" value="${installdir}" ask="0">
            <description></description>
            <explanation></explanation>
            <default></default>
            <allowEmptyValue>1</allowEmptyValue>
            <width>30</width>
        </stringParameter>
        <stringParameter name="java_launcher_binary_name" value="${project.shortName}-launcher.${platform_exec_suffix}" ask="0">
            <description></description>
            <explanation></explanation>
            <default></default>
            <allowEmptyValue>1</allowEmptyValue>
            <width>30</width>
        </stringParameter>
        <stringParameter name="java_launcher_arguments" value="" ask="0">
            <description></description>
            <explanation></explanation>
            <default></default>
            <allowEmptyValue>1</allowEmptyValue>
            <width>30</width>
        </stringParameter>
        <stringParameter name="java_launcher_vm_parameters" value="" ask="0">
            <description></description>
            <explanation></explanation>
            <default></default>
            <allowEmptyValue>1</allowEmptyValue>
            <width>30</width>
        </stringParameter>
        <stringParameter name="java_launcher_jar" value="OpenForisCalc.jar" ask="0">
            <description></description>
            <explanation></explanation>
            <default></default>
            <allowEmptyValue>1</allowEmptyValue>
            <width>30</width>
        </stringParameter>
        <stringParameter name="java_launcher_mainClass" value="org.openforis.calc.controlpanel.CalcControlPanel" ask="0">
            <description></description>
            <explanation></explanation>
            <default></default>
            <allowEmptyValue>1</allowEmptyValue>
            <width>30</width>
        </stringParameter>
        <stringParameter name="java_launcher_classpath" value="" ask="0">
            <description></description>
            <explanation></explanation>
            <default></default>
            <allowEmptyValue>1</allowEmptyValue>
            <width>30</width>
        </stringParameter>
        <stringParameter name="java_launcher_startmenu_shortcut_name" value="OpenForisCalc Control Panel" ask="0">
            <description></description>
            <explanation></explanation>
            <default></default>
            <allowEmptyValue>1</allowEmptyValue>
            <width>30</width>
        </stringParameter>
        <booleanParameter name="java_launcher_add_to_win_startmenu" value="1" ask="0">
            <description></description>
            <explanation></explanation>
            <default></default>
        </booleanParameter>
        <booleanParameter name="java_install_jre" value="1" ask="0">
            <description></description>
            <explanation></explanation>
            <default></default>
        </booleanParameter>
        <booleanParameter name="java_create_launcher" value="1" ask="0">
            <description></description>
            <explanation></explanation>
            <default></default>
        </booleanParameter>
        
    </parameterList>
    <postInstallationActionList>
        <addEnvironmentVariable>
            <name>CALC_HOME</name>
            <scope>system</scope>
            <value>${installdir}</value>
        </addEnvironmentVariable>
        <unzip>
            <destinationDirectory>${installdir}</destinationDirectory>
            <zipFile>${installdir}/calc-server.zip</zipFile>
        </unzip>
        <substitute>
            <files>${installdir}/calc-server/startup.sh;${installdir}/calc-server/shutdown.sh;${installdir}/calc-server/startup.cmd;${installdir}/calc-server/shutdown.cmd;${installdir}/R-linux/install.R;${installdir}/R-mac/install.R;${installdir}/R-windows/install.R;${installdir}/change_file_permissions.sh;</files>
            <type>exact</type>
            <substitutionList>
                <substitution>
                    <pattern>install_directory</pattern>
                    <value>${installdir}</value>
                </substitution>
            </substitutionList>
        </substitute>
        <substitute>
            <files>${installdir}/R-windows/install.R;</files>
            <type>exact</type>
            <ruleList>
                <platformTest>
                    <type>windows</type>
                </platformTest>
            </ruleList>
            <substitutionList>
                <substitution>
                    <pattern>\</pattern>
                    <value>/</value>
                </substitution>
            </substitutionList>
        </substitute>
        <!-- <addEnvironmentVariable>
            <name>JAVA_HOME</name>
            <scope>system</scope>
            <value>${installdir}/java</value>
            <ruleList>
                <platformTest>
                    <negate>1</negate>
                    <type>windows</type>
                </platformTest>
            </ruleList>
        </addEnvironmentVariable>
        <addEnvironmentVariable>
            <name>JAVA_HOME</name>
            <scope>system</scope>
            <value>${installdir}\java</value>
            <ruleList>
                <platformTest>
                    <type>windows</type>
                </platformTest>
            </ruleList>
        </addEnvironmentVariable> -->
        <addEnvironmentVariable>
            <name>R_HOME</name>
            <scope>system</scope>
            <value>${r_install_dir}</value>
        </addEnvironmentVariable>
        <substitute>
            <files>${installdir}/R-windows/install.cmd</files>
            <type>exact</type>
            <ruleList>
                <platformTest>
                    <type>windows-x86</type>
                </platformTest>
            </ruleList>
            <substitutionList>
                <substitution>
                    <pattern>R_BIN_DIRECTORY</pattern>
                    <value>${r_install_dir}\bin\i386</value>
                </substitution>
            </substitutionList>
        </substitute>
        <substitute>
            <files>${installdir}/R-windows/install.cmd</files>
            <type>exact</type>
            <ruleList>
                <platformTest>
                    <type>windows-x64</type>
                </platformTest>
            </ruleList>
            <substitutionList>
                <substitution>
                    <pattern>R_BIN_DIRECTORY</pattern>
                    <value>${r_install_dir}\bin\x64</value>
                </substitution>
            </substitutionList>
        </substitute>
        <runProgram>
            <program>${installdir}/R-linux/install.sh</program>
            <programArguments></programArguments>
            <progressText>Installing required R packages</progressText>
            <useMSDOSPath>0</useMSDOSPath>
            <workingDirectory>${installdir}/R-linux/</workingDirectory>
            <ruleList>
                <platformTest>
                    <type>linux</type>
                </platformTest>
            </ruleList>
        </runProgram>
        <runProgram>
            <program>${installdir}/R-mac/install.sh</program>
            <programArguments></programArguments>
            <progressText>Installing required R packages</progressText>
            <useMSDOSPath>0</useMSDOSPath>
            <workingDirectory>${installdir}/R-mac/</workingDirectory>
            <ruleList>
                <platformTest>
                    <type>osx</type>
                </platformTest>
            </ruleList>
        </runProgram>
        <runProgram>
            <program>${installdir}/R-windows/install.cmd</program>
            <programArguments>${installdir}/R-windows/</programArguments>
            <progressText>Installing required R packages</progressText>
            <ruleList>
                <platformTest>
                    <type>windows</type>
                </platformTest>
            </ruleList>
        </runProgram>
        <addDirectoryToPath>
            <insertAt>end</insertAt>
            <path>%JAVA_HOME%\bin;%R_HOME%\bin\i386;%R_HOME%\library\rJava\jri;%JAVA_HOME%\jre\bin\server;</path>
            <ruleList>
                <platformTest>
                    <type>windows-x86</type>
                </platformTest>
            </ruleList>
        </addDirectoryToPath>
        <addDirectoryToPath>
            <insertAt>end</insertAt>
            <path>%JAVA_HOME%\bin;%R_HOME%\bin\x64;%R_HOME%\library\rJava\jri\x64;%JAVA_HOME%\jre\bin\server;</path>
            <ruleList>
                <platformTest>
                    <type>windows-x64</type>
                </platformTest>
            </ruleList>
        </addDirectoryToPath>
        
        <createJavaLaunchers>
            <destination>${java_launcher_destination}</destination>
            <explanation>${msg(Installer.Java.CreateLaunchers.Explanation)}</explanation>
            <progressText>${msg(Installer.Java.CreateLaunchers.Text)}</progressText>
            <javaLauncherList>
                <javaLauncher>
                    <allowCommandLineArguments>1</allowCommandLineArguments>
                    <arguments>${java_launcher_arguments}</arguments>
                    <binaryName>${java_launcher_binary_name}</binaryName>
                    <classpath>${java_launcher_classpath}</classpath>
                    <jarFile>${java_launcher_jar}</jarFile>
                    <mainClass>${java_launcher_mainClass}</mainClass>
                    <preferredJavaBinary>${java_executable}</preferredJavaBinary>
                    <runInBackground>0</runInBackground>
                    <runInConsole>0</runInConsole>
                    <usePropertiesFile>0</usePropertiesFile>
                    <vmParameters>${java_launcher_vm_parameters}</vmParameters>
                    <windowsExecutableIcon>${installdir}/calc-server/tomcat/webapps/calc/img/of-logo-small-ico.ico</windowsExecutableIcon>
                    <windowsResourceFileVersion>${project.version}</windowsResourceFileVersion>
                    <workingDirectory>${java_launcher_destination}</workingDirectory>
                </javaLauncher>
            </javaLauncherList>
            <ruleList>
                <isTrue value="${java_create_launcher}"/>
            </ruleList>
        </createJavaLaunchers>

        <!-- create start menu shortcut(s) on Microsoft Windows -->
        <actionGroup>
            <actionList>
                <setInstallerVariable>
                    <name>java_launcher_startmenudirectory</name>
                    <value>${windows_folder_programs}</value>
                </setInstallerVariable>
                <setInstallerVariable>
                    <name>java_launcher_startmenudirectory</name>
                    <value>${windows_folder_common_programs}</value>
                    <ruleList>
                        <compareText logic="does_not_equal" text="${project.installationScope}" value="user"/>
                        <isTrue value="${installer_is_root_install}"/>
                    </ruleList>
                </setInstallerVariable>
                <setInstallerVariable>
                    <name>java_launcher_startmenudirectory</name>
                    <value>${java_launcher_startmenudirectory}/${project.startMenuGroupName}</value>
                </setInstallerVariable>
                <createDirectory>
                    <path>${java_launcher_startmenudirectory}</path>
                </createDirectory>
                <createShortcuts>
                    <destination>${java_launcher_startmenudirectory}</destination>
                    <explanation>${msg(Installer.Java.CreateLauncherShortcuts.Explanation)}</explanation>
                    <progressText>${msg(Installer.Java.CreateLauncherShortcuts.Text)}</progressText>
                    <shortcutList>
                        <startMenuShortcut>
                            <comment>${java_launcher_binary_name}</comment>
                            <name>${java_launcher_startmenu_shortcut_name}</name>
                            <runAsAdmin>0</runAsAdmin>
                            <runInTerminal>0</runInTerminal>
                            <windowsExec>${java_launcher_destination}/${java_launcher_binary_name}</windowsExec>
                            <windowsExecArgs></windowsExecArgs>
                            <windowsIcon>${installdir}/calc-server/tomcat/webapps/calc/img/of-logo-small-ico.ico</windowsIcon>
                            <windowsPath>${java_launcher_destination}</windowsPath>
                        </startMenuShortcut>
                    </shortcutList>
                </createShortcuts>
            </actionList>
            <ruleList>
                <platformTest type="windows"/>
                <isTrue value="${java_launcher_add_to_win_startmenu}"/>
                <isTrue value="${java_create_launcher}"/>
            </ruleList>
        </actionGroup>
        
        <changeOwnerAndGroup>
            <files>/home/${env(SUDO_USER)}/Desktop/${java_launcher_binary_name}</files>
            <group></group>
            <owner>${env(SUDO_USER)}</owner>
            <ruleList>
                <platformTest>
                    <type>linux</type>
                </platformTest>
            </ruleList>
        </changeOwnerAndGroup>
    </postInstallationActionList>
    <postUninstallationActionList>
        <deleteFile>
            <path>${installdir}</path>
        </deleteFile>
        <deleteFile>
            <path>${project.rollbackBackupDirectory}</path>
        </deleteFile>
    </postUninstallationActionList>
    <preInstallationActionList>
        <setInstallerVariable>
            <name>installdir</name>
            <value>${env(SYSTEMDRIVE)}/opt/${product_shortname}-${product_version}</value>
        </setInstallerVariable>
    </preInstallationActionList>
    <startMenuShortcutList>
        <startMenuShortcut>
            <comment>Uninstall ${product_fullname}</comment>
            <name>Uninstall ${product_fullname}</name>
            <runAsAdmin>0</runAsAdmin>
            <runInTerminal>0</runInTerminal>
            <windowsExec>${installdir}/${uninstallerName}.exe</windowsExec>
            <windowsExecArgs></windowsExecArgs>
            <windowsIcon></windowsIcon>
            <windowsPath>${installdir}/</windowsPath>
        </startMenuShortcut>
    </startMenuShortcutList>
</component>
