<component>
    <name>default</name>
    <description>Default Component</description>
    <canBeEdited>1</canBeEdited>
    <selected>1</selected>
    <show>1</show>
    <desktopShortcutList>
        <shortcut>
            <comment></comment>
            <exec>${installdir}/${java_launcher_binary_name}</exec>
            <icon>${installdir}/calc-server/tomcat/webapps/calc/img/of-logo-small.png</icon>
            <name>Open Foris Calc Control Panel</name>
            <path></path>
            <platforms>all</platforms>
            <runAsAdmin>0</runAsAdmin>
            <runInTerminal>0</runInTerminal>
            <windowsExec>${installdir}/${java_launcher_binary_name}</windowsExec>
            <windowsExecArgs></windowsExecArgs>
            <windowsIcon>${installdir}/calc-server/tomcat/webapps/calc/img/of-logo-small-ico.ico</windowsIcon>
            <windowsPath></windowsPath>
        </shortcut>
    </desktopShortcutList>
    <folderList>
        <folder>
            <description>Program Files</description>
            <destination>${installdir}</destination>
            <name>programfiles</name>
            <platforms>all</platforms>
            <distributionFileList>
                <distributionFile>
                    <origin>../../../../calc-control-panel/target/OpenForisCalc.jar</origin>
                </distributionFile>
                <distributionFile>
                    <origin>../../../../calc-assembly/target/calc-server.zip</origin>
                </distributionFile>
            </distributionFileList>
            <shortcutList>
                <shortcut>
                    <comment>Uninstall</comment>
                    <exec>${installdir}/${uninstallerName}</exec>
                    <icon></icon>
                    <name>Uninstall ${product_fullname}</name>
                    <path>${installdir}</path>
                    <platforms>all</platforms>
                    <runAsAdmin>0</runAsAdmin>
                    <runInTerminal>0</runInTerminal>
                    <windowsExec>${installdir}/${uninstallerName}.exe</windowsExec>
                    <windowsExecArgs></windowsExecArgs>
                    <windowsIcon></windowsIcon>
                    <windowsPath>${installdir}</windowsPath>
                </shortcut>
            </shortcutList>
        </folder>
        <folder>
            <description>Program Files</description>
            <destination>${installdir}</destination>
            <name>programfileslinux</name>
            <platforms>linux</platforms>
        </folder>
        <folder>
            <description>Program Files</description>
            <destination>${installdir}</destination>
            <name>programfileswindows</name>
            <platforms>windows</platforms>
        </folder>
        <folder>
            <description>Program Files</description>
            <destination>${installdir}</destination>
            <name>programfilesosx</name>
            <platforms>osx</platforms>
        </folder>
    </folderList>
    <parameterList>
        <directoryParameter>
            <name>installdir</name>
            <description>Installer.Parameter.installdir.description</description>
            <explanation>Installer.Parameter.installdir.explanation</explanation>
            <value></value>
            <default>${platform_install_prefix}/${product_shortname}</default>
            <allowEmptyValue>0</allowEmptyValue>
            <cliOptionName>prefix</cliOptionName>
            <mustBeWritable>1</mustBeWritable>
            <mustExist>0</mustExist>
            <width>30</width>
        </directoryParameter>
        <stringParameter>
            <name>postgres_password</name>
            <title>Please enter your admin postsgres password</title>
            <description></description>
            <explanation></explanation>
            <value>postgres</value>
            <default>postgres</default>
            <allowEmptyValue>0</allowEmptyValue>
            <width>40</width>
        </stringParameter>
    </parameterList>
    <postInstallationActionList>
        <addEnvironmentVariable>
            <name>CALC_HOME</name>
            <scope>user</scope>
            <value>${installdir}</value>
        </addEnvironmentVariable>
        <unzip>
            <destinationDirectory>${installdir}</destinationDirectory>
            <zipFile>${installdir}/calc-server.zip</zipFile>
        </unzip>
        <substitute>
            <files>${installdir}/calc-server/startup.sh;${installdir}/calc-server/shutdown.sh;${installdir}/calc-server/startup.cmd;${installdir}/calc-server/shutdown.cmd;${installdir}/calc-server/tomcat/bin/setenv.sh;${installdir}/calc-server/tomcat/bin/setenv.bat</files>
            <type>exact</type>
            <substitutionList>
                <substitution>
                    <pattern>install_directory</pattern>
                    <value>${installdir}</value>
                </substitution>
            </substitutionList>
        </substitute>

        <!--createJavaLaunchers>
            <destination>${java_launcher_destination}</destination>
            <explanation>${msg(Installer.Java.CreateLaunchers.Explanation)}</explanation>
            <progressText>${msg(Installer.Java.CreateLaunchers.Text)}</progressText>
            <javaLauncherList>
                <javaLauncher>
                    <allowCommandLineArguments>1</allowCommandLineArguments>
                    <arguments>${java_launcher_arguments}</arguments>
                    <binaryName>${java_launcher_binary_name}</binaryName>
                    <classpath>${java_launcher_classpath}</classpath>
                    <jarFile>${java_launcher_jar}</jarFile>
                    <mainClass>${java_launcher_mainClass}</mainClass>
                    <preferredJavaBinary>${java_executable}</preferredJavaBinary>
                    <runInBackground>0</runInBackground>
                    <runInConsole>0</runInConsole>
                    <usePropertiesFile>0</usePropertiesFile>
                    <vmParameters>${java_launcher_vm_parameters}</vmParameters>
                    <windowsExecutableIcon>${installdir}/calc-server/tomcat/webapps/calc/img/of-logo-small-ico.ico</windowsExecutableIcon>
                    <windowsResourceFileVersion>${project.version}</windowsResourceFileVersion>
                    <workingDirectory>${java_launcher_destination}</workingDirectory>
                </javaLauncher>
            </javaLauncherList>
            <ruleList>
                <isTrue value="${java_create_launcher}"/>
            </ruleList>
        </createJavaLaunchers
 create start menu shortcut(s) on Microsoft Windows 
actionGroup>
            <actionList>
                <setInstallerVariable>
                    <name>java_launcher_startmenudirectory</name>
                    <value>${windows_folder_programs}</value>
                </setInstallerVariable>
                <setInstallerVariable>
                    <name>java_launcher_startmenudirectory</name>
                    <value>${windows_folder_common_programs}</value>
                    <ruleList>
                        <compareText logic="does_not_equal" text="${project.installationScope}" value="user"/>
                        <isTrue value="${installer_is_root_install}"/>
                    </ruleList>
                </setInstallerVariable>
                <setInstallerVariable>
                    <name>java_launcher_startmenudirectory</name>
                    <value>${java_launcher_startmenudirectory}/${project.startMenuGroupName}</value>
                </setInstallerVariable>
                <createDirectory>
                    <path>${java_launcher_startmenudirectory}</path>
                </createDirectory>
                <createShortcuts>
                    <destination>${java_launcher_startmenudirectory}</destination>
                    <explanation>${msg(Installer.Java.CreateLauncherShortcuts.Explanation)}</explanation>
                    <progressText>${msg(Installer.Java.CreateLauncherShortcuts.Text)}</progressText>
                    <shortcutList>
                        <startMenuShortcut>
                            <comment>${java_launcher_binary_name}</comment>
                            <name>${java_launcher_startmenu_shortcut_name}</name>
                            <runAsAdmin>0</runAsAdmin>
                            <runInTerminal>0</runInTerminal>
                            <windowsExec>${java_launcher_destination}/${java_launcher_binary_name}</windowsExec>
                            <windowsExecArgs></windowsExecArgs>
                            <windowsIcon>${installdir}/calc-server/tomcat/webapps/calc/img/of-logo-small-ico.ico</windowsIcon>
                            <windowsPath>${java_launcher_destination}</windowsPath>
                        </startMenuShortcut>
                    </shortcutList>
                </createShortcuts>
            </actionList>
            <ruleList>
                <platformTest type="windows"/>
                <isTrue value="${java_launcher_add_to_win_startmenu}"/>
                <isTrue value="${java_create_launcher}"/>
            </ruleList>
        </actionGroup-->
        <changeOwnerAndGroup>
            <files>/home/${env(SUDO_USER)}/Desktop/${java_launcher_binary_name}</files>
            <group></group>
            <owner>${env(SUDO_USER)}</owner>
            <ruleList>
                <platformTest>
                    <type>linux</type>
                </platformTest>
            </ruleList>
        </changeOwnerAndGroup>
        <substitute>
            <files>${installdir}/calc-server/tomcat/conf/Catalina/localhost/calc.xml</files>
            <type>exact</type>
            <substitutionList>
                <substitution>
                    <pattern>ADMIN_PASSWORD</pattern>
                    <value>${postgres_password}</value>
                </substitution>
            </substitutionList>
        </substitute>
        <getFreePort>
            <finalPort>8046</finalPort>
            <initialPort>8006</initialPort>
            <variable>tomcat_shutdown</variable>
        </getFreePort>
        <substitute>
            <files>${installdir}/calc-server/tomcat/conf/server.xml</files>
            <type>exact</type>
            <substitutionList>
                <substitution>
                    <pattern>8006</pattern>
                    <value>${tomcat_shutdown}</value>
                </substitution>
            </substitutionList>
        </substitute>
        <getFreePort>
            <finalPort>8121</finalPort>
            <initialPort>8081</initialPort>
            <variable>tomcat_http</variable>
        </getFreePort>
        <substitute>
            <files>${installdir}/calc-server/tomcat/conf/server.xml</files>
            <type>exact</type>
            <substitutionList>
                <substitution>
                    <pattern>8081</pattern>
                    <value>${tomcat_http}</value>
                </substitution>
            </substitutionList>
        </substitute>
        <substitute>
            <files>${installdir}/calc-server/tomcat/calc.properties</files>
            <type>exact</type>
            <substitutionList>
                <substitution>
                    <pattern>{HTTP_PORT}</pattern>
                    <value>${tomcat_http}</value>
                </substitution>
            </substitutionList>
        </substitute>
        <getFreePort>
            <finalPort>8484</finalPort>
            <initialPort>8444</initialPort>
            <variable>tomcat_redirect</variable>
        </getFreePort>
        <substitute>
            <files>${installdir}/calc-server/tomcat/conf/server.xml</files>
            <type>exact</type>
            <substitutionList>
                <substitution>
                    <pattern>8444</pattern>
                    <value>${tomcat_redirect}</value>
                </substitution>
            </substitutionList>
        </substitute>
        <getFreePort>
            <finalPort>8050</finalPort>
            <initialPort>8010</initialPort>
            <variable>tomcat_ajp</variable>
        </getFreePort>
        <substitute>
            <files>${installdir}/calc-server/tomcat/conf/server.xml</files>
            <type>exact</type>
            <substitutionList>
                <substitution>
                    <pattern>8010</pattern>
                    <value>${tomcat_ajp}</value>
                </substitution>
            </substitutionList>
        </substitute>
        <if>
            <actionList>
                <copyFile>
                    <destination>${installdir}/calc-server/tomcat/webapps/saiku/WEB-INF/classes/</destination>
                    <origin>${system_temp_directory}/saiku-repository</origin>
                </copyFile>
                <deleteFile>
                    <path>${system_temp_directory}/saiku-repository</path>
                </deleteFile>
            </actionList>
            <conditionRuleList>
                <fileExists>
                    <path>${system_temp_directory}/saiku-repository</path>
                </fileExists>
            </conditionRuleList>
        </if>
    </postInstallationActionList>
    <postUninstallationActionList>
        <deleteEnvironmentVariable>
            <name>CALC_HOME</name>
            <scope>user</scope>
        </deleteEnvironmentVariable>
        <deleteFile>
            <path>${installdir}</path>
        </deleteFile>
        <deleteFile>
            <path>${project.rollbackBackupDirectory}</path>
        </deleteFile>
    </postUninstallationActionList>
    <preInstallationActionList>
        <deleteFile>
            <path>${system_temp_directory}/saiku-repository</path>
        </deleteFile>
        <if>
            <actionList>
                <copyFile>
                    <destination>${system_temp_directory}/saiku-repository</destination>
                    <matchHiddenFiles>1</matchHiddenFiles>
                    <origin>${env(CALC_HOME)}/calc-server/tomcat/webapps/saiku/WEB-INF/classes/saiku-repository</origin>
                </copyFile>
                <deleteFile>
                    <path>${env(CALC_HOME)}</path>
                </deleteFile>
            </actionList>
            <conditionRuleList>
                <compareText>
                    <logic>does_not_equal</logic>
                    <text>${env(CALC_HOME)}</text>
                    <value></value>
                </compareText>
            </conditionRuleList>
        </if>
        <if>
            <actionList>        
            	<setInstallerVariable>
            		<name>installdir</name>
            		<value>${env(CALC_HOME)}</value>
        		</setInstallerVariable>
            </actionList>
            <conditionRuleList>
                <compareText>
                    <logic>does_not_equal</logic>
                    <text>${env(CALC_HOME)}</text>
                    <value></value>
                </compareText>
            </conditionRuleList>
            <elseActionList>
                <setInstallerVariable>
                    <name>installdir</name>
                    <value>${env(SYSTEMDRIVE)}/opt/${product_shortname}</value>
                </setInstallerVariable>
            </elseActionList>
        </if>
        <!--setInstallerVariable>
            <name>installdir</name>
            <value>${env(SYSTEMDRIVE)}/opt/${product_shortname}</value>
        </setInstallerVariable-->
    </preInstallationActionList>
    <startMenuShortcutList>
        <startMenuShortcut>
            <comment>Uninstall ${product_fullname}</comment>
            <name>Uninstall ${product_fullname}</name>
            <runAsAdmin>0</runAsAdmin>
            <runInTerminal>0</runInTerminal>
            <windowsExec>${installdir}/${uninstallerName}.exe</windowsExec>
            <windowsExecArgs></windowsExecArgs>
            <windowsIcon></windowsIcon>
            <windowsPath>${installdir}/</windowsPath>
        </startMenuShortcut>
    </startMenuShortcutList>
</component>
